<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MQTT Publisher/Subscriber</title>
    <!-- Include the HiveMQ MQTT library -->
    <script src="https://cdn.jsdelivr.net/npm/@hivemq/mqtt-web-client@1.3.0/dist/mqtt-web-client.js"></script>
</head>
<body>

<script>
    // Replace with your actual HiveMQ Cloud credentials
    const host = "95ea70d6edb34e4a956c8f346ae8fba8.s1.eu.hivemq.cloud";
    const username = "Eidyn";
    const password = "Mqtt1111";

    // Create an MQTT client instance
    const client = new HiveMQ.Client({
        host,
        port: 8884,
        protocol: "wss", // WebSocket Secure
        username,
        password,
        clientId: "mqtt_client_" + Math.random().toString(16).substr(2, 8),
        rejectUnauthorized: false // Ignore self-signed certificate warnings
    });

    // Connect to the MQTT broker
    client.connect();

    // Subscribe to the specified topics
    const topicsToSubscribe = ["Kanyon/HV_Voltage", "Kanyon/LV_Voltage", "Kanyon/LV_soc"];
    topicsToSubscribe.forEach(topic => {
        client.subscribe(topic, { qos: 2 });
    });

    // Function to publish "1" to the "Kanyon/mqtt_request" topic every 5 seconds
    function publishMessage() {
        client.publish("Kanyon/mqtt_request", "1", { qos: 2 });
    }

    // Publish the message every 5 seconds
    setInterval(publishMessage, 5000);

    // Handle incoming messages
    client.on("message", (topic, payload, packet) => {
        // Handle incoming messages here
        console.log(`Received message on topic '${topic}': ${payload}`);
    });
</script>

</body>
</html>
